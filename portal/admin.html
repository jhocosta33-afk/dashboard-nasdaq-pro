<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin | Dashboard NASDAQ PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root {
  --bg: #020617;
  --card: #0f172a;
  --border: rgba(255,255,255,.1);
  --text: #e5e7eb;
  --text-muted: #94a3b8;
  --accent: #22c55e;
  --red: #ef4444;
  --blue: #3b82f6;
  --orange: #f97316;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  min-height: 100vh;
}

/* HEADER */
header {
  background: var(--card);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo { font-size: 24px; }

h1 {
  font-size: 20px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent), var(--blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 14px;
}

.btn-logout {
  background: var(--red);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
}

.btn-logout:hover { opacity: 0.8; }

/* MAIN CONTAINER */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 24px;
}

/* TABS */
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
}

.tab {
  padding: 12px 20px;
  border: none;
  background: none;
  color: var(--text-muted);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all .2s;
  white-space: nowrap;
}

.tab.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}

.tab:hover { color: var(--text); }

/* SECTION */
.section {
  display: none;
}

.section.active {
  display: block;
}

/* CARDS */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
}

.card h2 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

/* FORMS */
.form-group {
  margin-bottom: 16px;
}

label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 6px;
  color: var(--text);
}

input, textarea, select {
  width: 100%;
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 14px;
  color: var(--text);
  font-family: inherit;
  transition: all .2s;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: var(--accent);
  background: rgba(255,255,255,0.08);
}

.btn {
  background: var(--accent);
  color: #000;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
}

.btn:hover {
  background: #16a34a;
  transform: scale(1.02);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.btn-secondary {
  background: var(--blue);
}

.btn-danger {
  background: var(--red);
  color: #fff;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th {
  text-align: left;
  padding: 12px;
  background: rgba(255,255,255,0.03);
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: 12px;
  text-transform: uppercase;
  color: var(--text-muted);
}

td {
  padding: 12px;
  border-bottom: 1px solid var(--border);
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
}

.badge.pending {
  background: rgba(251, 191, 36, 0.1);
  color: #fbbf24;
}

.badge.approved {
  background: rgba(34, 197, 94, 0.1);
  color: var(--accent);
}

.badge.admin {
  background: rgba(59, 130, 246, 0.1);
  color: var(--blue);
}

/* POSTS LIST */
.posts-list {
  display: grid;
  gap: 16px;
}

.post-item {
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
  display: flex;
  gap: 16px;
}

.post-image {
  width: 120px;
  height: 80px;
  object-fit: cover;
  border-radius: 8px;
  flex-shrink: 0;
}

.post-content {
  flex: 1;
}

.post-title {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 6px;
}

.post-text {
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 8px;
  line-height: 1.5;
}

.post-meta {
  font-size: 12px;
  color: var(--text-muted);
}

.post-actions {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.btn-sm {
  padding: 6px 12px;
  font-size: 12px;
}

/* UPLOAD AREA */
.upload-area {
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all .3s ease;
  background: rgba(255,255,255,0.02);
}

.upload-area:hover {
  border-color: var(--accent);
  background: rgba(34,197,94,0.05);
}

.upload-area.dragover {
  border-color: var(--accent);
  background: rgba(34,197,94,0.1);
  transform: scale(1.02);
}

.upload-placeholder p {
  margin: 12px 0 8px 0;
  color: var(--text);
}

.upload-preview {
  position: relative;
  display: none;
}

.upload-preview img {
  max-width: 100%;
  max-height: 300px;
  border-radius: 8px;
  margin-bottom: 12px;
  border: 1px solid var(--border);
}

.btn-remove-image {
  background: var(--red);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
}

.btn-remove-image:hover {
  opacity: 0.8;
}

.upload-progress {
  padding: 30px;
  display: none;
}

.upload-progress p {
  margin-top: 12px;
  color: var(--text-muted);
}

/* ALERT */
.alert {
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 16px;
  font-size: 14px;
  display: none;
}

.alert.success {
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid rgba(34, 197, 94, 0.3);
  color: var(--accent);
}

.alert.error {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  color: var(--red);
}

/* LOADING */
.loading {
  text-align: center;
  padding: 40px;
  color: var(--text-muted);
}

.spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 12px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* UPLOAD AREA */
.upload-area {
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all .3s ease;
  background: rgba(255,255,255,0.02);
}

.upload-area:hover {
  border-color: var(--accent);
  background: rgba(34,197,94,0.05);
}

.upload-area.dragover {
  border-color: var(--accent);
  background: rgba(34,197,94,0.1);
  transform: scale(1.02);
}

.upload-placeholder p {
  margin: 8px 0;
  color: var(--text);
}

.upload-placeholder small {
  color: var(--text-muted);
  font-size: 12px;
}

.upload-preview {
  position: relative;
}

.upload-preview img {
  max-width: 100%;
  max-height: 300px;
  border-radius: 8px;
  margin-bottom: 12px;
}

.btn-remove {
  background: var(--red);
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
}

.btn-remove:hover {
  background: #dc2626;
}

.upload-progress {
  padding: 40px;
  text-align: center;
}

.upload-progress p {
  margin-top: 12px;
  color: var(--text-muted);
}

/* POSTS GRID */
.posts-grid {
  display: grid;
  gap: 24px;
}

.post-card {
  transition: transform .3s, box-shadow .3s;
}

.post-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
}

.post-card img:hover {
  transform: scale(1.02);
}

.filter-btn {
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
}

.filter-btn:hover {
  background: rgba(255,255,255,0.1);
  transform: scale(1.05);
}

.filter-btn.active {
  background: var(--accent);
  border-color: var(--accent);
  color: #000;
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .container { padding: 16px; }
  .tabs { padding-bottom: 8px; }
  .post-item { flex-direction: column; }
  .post-image { width: 100%; height: 160px; }
  table { font-size: 12px; }
  th, td { padding: 8px; }
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <span class="logo">üëë</span>
    <h1>Painel Admin</h1>
  </div>
  <div class="user-info">
    <a href="../" style="display:inline-block;background:rgba(255,255,255,0.1);color:var(--text);border:1px solid var(--border);padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;text-decoration:none;margin-right:12px;transition:all .2s;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
      üìä Dashboard
    </a>
    <span id="adminName">Admin</span>
    <button class="btn-logout" onclick="logout()">Sair</button>
  </div>
</header>

<div class="container">
  
  <!-- TABS -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('posts')">üìù Posts</button>
    <button class="tab" onclick="switchTab('aprovacoes')">‚úÖ Aprovar Alunos</button>
    <button class="tab" onclick="switchTab('planilha')">üìä Planilha & Fotos</button>
  </div>

  <!-- SE√á√ÉO: POSTS (CRIAR + VER) -->
  <div id="posts-section" class="section active">
    <div class="card">
      <h2>‚ú® Criar Novo Post</h2>
      
      <div id="alert-post" class="alert"></div>

      <form id="formPost">
        <div class="form-group">
          <label for="postTitulo">T√≠tulo</label>
          <input type="text" id="postTitulo" placeholder="Ex: An√°lise semanal do NASDAQ" required>
        </div>

        <div class="form-group">
          <label for="postTexto">Texto (opcional)</label>
          <textarea id="postTexto" placeholder="Escreva o conte√∫do do post..."></textarea>
        </div>

        <div class="form-group">
          <label for="postCategoria">Categoria</label>
          <select id="postCategoria">
            <option value="sala-ao-vivo">üî¥ Sala ao Vivo</option>
            <option value="materiais">üìö Materiais</option>
            <option value="analise">üìà An√°lise</option>
            <option value="tutorial">üéì Tutorial</option>
            <option value="noticia">üì∞ Not√≠cia</option>
            <option value="link">üîó Link √ötil</option>
          </select>
        </div>

        <div class="form-group">
          <label for="postLink">Link (opcional)</label>
          <input type="url" id="postLink" placeholder="https://exemplo.com">
        </div>

        <div class="form-group">
          <label>Arquivo/M√≠dia (opcional)</label>
          <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 12px;">
            üìé Qualquer arquivo (imagens, v√≠deos, PDFs, ZIPs, indicadores, etc) - At√© 500MB
          </p>
          
          <div class="upload-area" id="uploadAreaUniversal" style="border: 2px dashed var(--border); border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; transition: all .3s; background: rgba(255,255,255,0.02);">
            <input type="file" id="postArquivo" accept="*" multiple style="display:none">
            
            <div class="upload-placeholder" id="uploadPlaceholderUniversal">
              <span style="font-size:64px">üìé</span>
              <p style="margin: 16px 0 8px 0;"><strong>Arraste qualquer arquivo aqui</strong><br>ou clique para selecionar</p>
              <small style="color:var(--text-muted)">Qualquer tipo de arquivo - At√© 500MB</small>
            </div>
            
            <div class="upload-preview" id="uploadPreviewUniversal" style="display:none;">
              <div id="previewContent"></div>
              <button type="button" class="btn-remove-image" onclick="removerArquivoUniversal()">‚ùå Remover</button>
            </div>
            
            <div class="upload-progress" id="uploadProgressUniversal" style="display:none; padding: 40px; text-align: center;">
              <div class="spinner"></div>
              <p id="uploadProgressTextUniversal" style="margin: 16px 0 12px 0; color: var(--text); font-weight: 600;">Fazendo upload...</p>
              <div style="width: 100%; max-width: 400px; margin: 0 auto; background: rgba(255,255,255,0.1); height: 8px; border-radius: 10px; overflow: hidden;">
                <div id="uploadProgressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--accent), #16a34a); transition: width 0.3s ease; box-shadow: 0 0 10px var(--accent);"></div>
              </div>
              <p id="uploadProgressPercent" style="margin-top: 8px; font-size: 13px; color: var(--text-muted); font-weight: 600;">0%</p>
            </div>
          </div>

          <input type="hidden" id="postMidiaURL">
          <input type="hidden" id="postMidiaTipo">
        </div>

        <button type="submit" class="btn" id="btnPost">Publicar Post</button>
      </form>
    </div>

    <div class="card">
      <h2>üìö Posts Publicados</h2>
      <div id="posts-list" class="posts-list">
        <div class="loading">
          <div class="spinner"></div>
          <p>Carregando posts...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SE√á√ÉO: APROVA√á√ïES -->
  <div id="aprovacoes-section" class="section">
    <div class="card">
      <h2>üë• Alunos Pendentes</h2>
      <div id="alert-aprovacao" class="alert"></div>
      <div id="usuarios-pendentes">
        <div class="loading">
          <div class="spinner"></div>
          <p>Carregando usu√°rios...</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>‚úÖ Alunos Aprovados</h2>
      <div id="usuarios-aprovados">
        <div class="loading">
          <div class="spinner"></div>
          <p>Carregando usu√°rios...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- SE√á√ÉO: PLANILHA & FOTOS DE TRADES -->
  <div id="planilha-section" class="section">
    
    <!-- Formul√°rio de Dados do Trade -->
    <div class="card">
      <h2>üìä Registrar Trade do Dia</h2>
      <p style="color: var(--text-muted); margin-bottom: 16px;">
        Preencha os dados do trade e a planilha ser√° atualizada automaticamente.
      </p>
      <div id="alert-trade-data" class="alert"></div>
      
      <form id="formTradeData">
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
          <div class="form-group">
            <label for="diaData">Dia</label>
            <input 
              type="number" 
              id="diaData" 
              min="1" 
              max="31" 
              required 
              placeholder="12"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>

          <div class="form-group">
            <label for="mesData">M√™s</label>
            <select 
              id="mesData" 
              required
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
              <option value="1">Janeiro</option>
              <option value="2">Fevereiro</option>
              <option value="3">Mar√ßo</option>
              <option value="4">Abril</option>
              <option value="5">Maio</option>
              <option value="6">Junho</option>
              <option value="7">Julho</option>
              <option value="8">Agosto</option>
              <option value="9">Setembro</option>
              <option value="10">Outubro</option>
              <option value="11">Novembro</option>
              <option value="12">Dezembro</option>
            </select>
          </div>

          <div class="form-group">
            <label for="anoData">Ano</label>
            <input 
              type="number" 
              id="anoData" 
              min="2020" 
              max="2030" 
              required 
              placeholder="2026"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
          <div class="form-group">
            <label for="semana">Semana do M√™s (autom√°tico)</label>
            <input 
              type="text" 
              id="semana" 
              readonly
              placeholder="Calculado automaticamente"
              style="width: 100%; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text-muted); cursor: not-allowed;">
          </div>

          <div class="form-group">
            <label for="alvo">Ativo/Alvo</label>
            <input 
              type="text" 
              id="alvo" 
              required 
              placeholder="Ex: NASDAQ, SP500, WIN..."
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label for="pontos">Pontos</label>
            <input 
              type="number" 
              id="pontos" 
              required 
              placeholder="Ex: 15 ou -10"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>

          <div class="form-group">
            <label for="trades">Total de Trades</label>
            <input 
              type="number" 
              id="trades" 
              min="0" 
              required 
              placeholder="Ex: 3"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>

          <div class="form-group">
            <label for="gains">Gains</label>
            <input 
              type="number" 
              id="gains" 
              min="0" 
              required 
              placeholder="Ex: 2"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>

          <div class="form-group">
            <label for="stops">Stops</label>
            <input 
              type="number" 
              id="stops" 
              min="0" 
              required 
              placeholder="Ex: 1"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>

          <div class="form-group">
            <label for="breakeven">Breakeven (0x0)</label>
            <input 
              type="number" 
              id="breakeven" 
              min="0" 
              required 
              placeholder="Ex: 0"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>
        </div>

        <button type="submit" class="btn" id="btnTradeData" style="margin-top: 16px;">Salvar na Planilha</button>
      </form>

      <div style="margin-top: 20px; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid var(--border);">
        <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">
          üí° <strong>Dica:</strong> Quer ver/editar a planilha completa?
        </p>
        <a href="https://docs.google.com/spreadsheets/d/1iawimQW3a9bWC4-pTJxvnu3ED62AcN-TjthXwpaIQ10/edit" target="_blank" class="btn btn-secondary" style="display: inline-block; padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 6px; text-decoration: none; font-size: 13px;">
          üìä Abrir Planilha no Google Sheets
        </a>
      </div>
    </div>

    <!-- Upload de Fotos de Trades -->
    <div class="card">
      <h2>üì∏ Fotos dos Trades</h2>
      <div id="alert-foto-trade" class="alert"></div>
      
      <form id="formFotoTrade">
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label for="diaDoTrade">Dia</label>
            <input 
              type="number" 
              id="diaDoTrade" 
              min="1" 
              max="31" 
              required 
              placeholder="12"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>

          <div class="form-group">
            <label for="mesDoTrade">M√™s</label>
            <select 
              id="mesDoTrade" 
              required
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
              <option value="1">Janeiro</option>
              <option value="2">Fevereiro</option>
              <option value="3">Mar√ßo</option>
              <option value="4">Abril</option>
              <option value="5">Maio</option>
              <option value="6">Junho</option>
              <option value="7">Julho</option>
              <option value="8">Agosto</option>
              <option value="9">Setembro</option>
              <option value="10">Outubro</option>
              <option value="11">Novembro</option>
              <option value="12">Dezembro</option>
            </select>
          </div>

          <div class="form-group">
            <label for="anoDoTrade">Ano</label>
            <input 
              type="number" 
              id="anoDoTrade" 
              min="2020" 
              max="2030" 
              required 
              placeholder="2026"
              style="width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; font-size: 14px; color: var(--text);">
          </div>
        </div>

        <div class="form-group">
          <label>Foto do Trade</label>
          <div class="upload-area" id="uploadAreaTrade" style="cursor: pointer; border: 2px dashed var(--border); border-radius: 12px; padding: 30px; text-align: center; transition: all .3s;">
            <input type="file" id="fileInputTrade" accept="image/*" style="display:none">
            <div id="uploadPlaceholderTrade">
              <span style="font-size:48px">üì∏</span>
              <p><strong>Arraste a foto do trade aqui</strong><br>ou clique para selecionar</p>
              <small style="color:var(--text-muted)">JPG, PNG at√© 10MB</small>
            </div>
            <div id="uploadPreviewTrade" style="display:none">
              <img id="previewImgTrade" src="" alt="Preview" style="max-width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 12px;">
              <button type="button" class="btn-remove" onclick="event.stopPropagation(); removerImagemTrade()">‚úï Remover</button>
            </div>
            <div id="uploadProgressTrade" style="display:none; text-align: center; padding: 40px;">
              <div class="spinner"></div>
              <p id="uploadProgressTextTrade" style="color: var(--text-muted);">Fazendo upload...</p>
            </div>
          </div>
        </div>

        <button type="submit" class="btn" id="btnFotoTrade">Salvar Foto do Trade</button>
      </form>
    </div>

  </div>

</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VERIFICA√á√ÉO DE ACESSO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
verificarAutenticacao(async (user) => {
  const isAdmin = await verificarAdmin(user.uid);
  if (!isAdmin) {
    alert('‚ùå Acesso negado. Apenas administradores.');
    auth.signOut();
    window.location.href = 'login.html';
    return;
  }
  
  document.getElementById('adminName').textContent = user.displayName || user.email;
  carregarPosts();
  carregarUsuarios();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FUN√á√ïES AUXILIARES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(tabName) {
  // Atualiza tabs
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  
  // Adiciona active na tab clicada
  const tabs = document.querySelectorAll('.tab');
  tabs.forEach(tab => {
    if (tab.getAttribute('onclick').includes(tabName)) {
      tab.classList.add('active');
    }
  });
  
  // Atualiza sections
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  const section = document.getElementById(`${tabName}-section`);
  if (section) {
    section.classList.add('active');
  }
  
  // Carrega dados espec√≠ficos de cada aba
  if (tabName === 'posts') {
    carregarPosts();
  } else if (tabName === 'aprovacoes') {
    carregarUsuarios();
  } else if (tabName === 'planilha') {
    // Planilha j√° carrega automaticamente
  }
}

function logout() {
  if (confirm('Deseja realmente sair?')) {
    auth.signOut();
    window.location.href = 'login.html';
  }
}

function mostrarAlerta(id, mensagem, tipo) {
  const alert = document.getElementById(id);
  alert.textContent = mensagem;
  alert.className = `alert ${tipo}`;
  alert.style.display = 'block';
  setTimeout(() => alert.style.display = 'none', 5000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPLOAD UNIVERSAL - ARQUIVO √öNICO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let arquivoUniversal = null;
let tipoArquivo = null;

const uploadAreaUniversal = document.getElementById('uploadAreaUniversal');
const fileInputUniversal = document.getElementById('postArquivo');
const uploadPlaceholderUniversal = document.getElementById('uploadPlaceholderUniversal');
const uploadPreviewUniversal = document.getElementById('uploadPreviewUniversal');
const uploadProgressUniversal = document.getElementById('uploadProgressUniversal');

// Click na √°rea = abrir seletor
uploadAreaUniversal.addEventListener('click', () => fileInputUniversal.click());

// Drag and drop
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  uploadAreaUniversal.addEventListener(eventName, (e) => {
    e.preventDefault();
    e.stopPropagation();
  });
});

['dragenter', 'dragover'].forEach(eventName => {
  uploadAreaUniversal.addEventListener(eventName, () => uploadAreaUniversal.classList.add('dragover'));
});

['dragleave', 'drop'].forEach(eventName => {
  uploadAreaUniversal.addEventListener(eventName, () => uploadAreaUniversal.classList.remove('dragover'));
});

uploadAreaUniversal.addEventListener('drop', (e) => {
  const files = e.dataTransfer.files;
  if (files.length > 0) handleArquivoUniversal(files[0]);
});

fileInputUniversal.addEventListener('change', (e) => {
  if (e.target.files.length > 1) {
    alert(`‚ö†Ô∏è Voc√™ selecionou ${e.target.files.length} arquivos.\n\nPor enquanto, apenas o primeiro arquivo ser√° enviado.\n\nüí° Dica: Crie posts separados para cada arquivo ou comprima tudo em um ZIP.`);
  }
  if (e.target.files.length > 0) handleArquivoUniversal(e.target.files[0]);
});

function handleArquivoUniversal(file) {
  // Validar tamanho (100MB)
  if (file.size > 500 * 1024 * 1024) {
    alert('‚ùå Arquivo muito grande. M√°ximo 500MB');
    return;
  }

  arquivoUniversal = file;

  // Detectar tipo
  if (file.type.startsWith('image/')) {
    tipoArquivo = 'imagem';
  } else if (file.type.startsWith('video/')) {
    tipoArquivo = 'video';
  } else {
    tipoArquivo = 'pdf';
  }

  // Mostrar preview
  uploadPlaceholderUniversal.style.display = 'none';
  uploadPreviewUniversal.style.display = 'block';

  const previewContent = document.getElementById('previewContent');
  const sizeMB = (file.size / (1024 * 1024)).toFixed(2);

  if (tipoArquivo === 'imagem') {
    const reader = new FileReader();
    reader.onload = (e) => {
      previewContent.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 300px; border-radius: 8px; margin-bottom: 12px;">
        <p style="font-size: 13px; color: var(--text-muted);">üì∏ ${file.name} (${sizeMB} MB)</p>`;
    };
    reader.readAsDataURL(file);
  } else if (tipoArquivo === 'video') {
    previewContent.innerHTML = `<div style="padding: 24px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 12px;">
      <span style="font-size: 64px;">üé•</span>
      <p style="font-size: 16px; font-weight: 600; margin: 12px 0;">${file.name}</p>
      <p style="font-size: 13px; color: var(--text-muted);">${sizeMB} MB</p>
    </div>`;
  } else {
    previewContent.innerHTML = `<div style="padding: 24px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 12px;">
      <span style="font-size: 64px;">üìÑ</span>
      <p style="font-size: 16px; font-weight: 600; margin: 12px 0;">${file.name}</p>
      <p style="font-size: 13px; color: var(--text-muted);">${sizeMB} MB</p>
    </div>`;
  }
}

function removerArquivoUniversal() {
  arquivoUniversal = null;
  tipoArquivo = null;
  fileInputUniversal.value = '';
  uploadPlaceholderUniversal.style.display = 'block';
  uploadPreviewUniversal.style.display = 'none';
  document.getElementById('previewContent').innerHTML = '';
}

// Upload para ImgBB
async function uploadImagemImgBB(file) {
  const formData = new FormData();
  formData.append('image', file);

  try {
    const response = await fetch('https://api.imgbb.com/1/upload?expiration=0&key=d4b6fa5e0c3e2e6f5c8e0e8e8e8e8e8e', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) throw new Error('Erro no upload');

    const data = await response.json();

    if (data.success && data.data) {
      return data.data.url;
    } else {
      throw new Error('Upload falhou');
    }
  } catch (error) {
    console.error('Erro no upload ImgBB:', error);
    
    // Fallback: base64
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => resolve(e.target.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }
}

// Upload v√≠deo para Streamable
async function uploadVideoStreamable(file) {
  const formData = new FormData();
  formData.append('file', file);

  try {
    const response = await fetch('https://api.streamable.com/upload', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) throw new Error('Erro no upload');

    const data = await response.json();
    
    if (data.shortcode) {
      return `https://streamable.com/${data.shortcode}`;
    }
    
    throw new Error('Upload falhou');
    
  } catch (error) {
    console.error('Erro no upload de v√≠deo:', error);
    alert('‚ö†Ô∏è Falha no upload. Use o campo "Link" para adicionar v√≠deo do YouTube/Vimeo');
    throw error;
  }
}


// Upload de PDF/Arquivo via Google Drive
async function uploadArquivoGoogleDrive(file) {
  try {
    const base64 = await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });

    const params = new URLSearchParams();
    params.append('acao', 'uploadArquivo');
    params.append('arquivo', base64);
    params.append('nome', file.name);
    params.append('tipo', file.type);

    const response = await fetch('https://script.google.com/macros/s/AKfycbxp_oeOJcpv-YqaQLVk3lb7DMsuHdbLdkKO32c0rezjEmPa7pQy06JzHOdoOga43l-R/exec', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: params.toString()
    });

    const resultado = await response.json();
    
    if (resultado.success && resultado.url) {
      return resultado.url;
    }
    
    throw new Error(resultado.error || 'Erro no upload');
    
  } catch (error) {
    console.error('Erro no upload de arquivo:', error);
    throw error;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// POSTS - PUBLICA√á√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

document.getElementById('formPost').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const btnPost = document.getElementById('btnPost');
  btnPost.disabled = true;
  btnPost.textContent = 'Publicando...';

  try {
    let finalMidiaURL = null;
    let midiaTipo = null;

    // Upload de arquivo (se houver) - TUDO VIA GOOGLE DRIVE
    if (arquivoUniversal) {
      uploadPreviewUniversal.style.display = 'none';
      uploadProgressUniversal.style.display = 'block';
      
      const sizeMB = (arquivoUniversal.size / (1024 * 1024)).toFixed(2);
      document.getElementById('uploadProgressTextUniversal').textContent = `Enviando ${sizeMB}MB para Google Drive...`;
      
      // Simular progresso (barra animada)
      const progressBar = document.getElementById('uploadProgressBar');
      const progressPercent = document.getElementById('uploadProgressPercent');
      let progress = 0;
      
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        progressBar.style.width = progress + '%';
        progressPercent.textContent = Math.round(progress) + '%';
      }, 200);

      try {
        // TUDO vai para Google Drive agora (imagem, v√≠deo, PDF, ZIP, etc)
        finalMidiaURL = await uploadArquivoGoogleDrive(arquivoUniversal);
        midiaTipo = tipoArquivo; // imagem, video ou pdf
        
        // Completar progresso
        clearInterval(progressInterval);
        progressBar.style.width = '100%';
        progressPercent.textContent = '100%';
        
        console.log('‚úÖ Arquivo enviado para Google Drive:', finalMidiaURL);
      } catch (error) {
        clearInterval(progressInterval);
        console.error('‚ùå Erro no upload:', error);
        throw error;
      }

      uploadProgressUniversal.style.display = 'none';
      uploadPreviewUniversal.style.display = 'block';
    }

    // Valida√ß√£o: precisa ter pelo menos t√≠tulo OU arquivo
    const titulo = document.getElementById('postTitulo').value.trim();
    const texto = document.getElementById('postTexto').value.trim();
    
    if (!titulo && !finalMidiaURL) {
      alert('‚ùå Preencha pelo menos o t√≠tulo ou adicione um arquivo');
      throw new Error('T√≠tulo ou arquivo obrigat√≥rio');
    }

    // Salva post no Firestore
    await db.collection('posts').add({
      titulo: titulo || 'Post sem t√≠tulo',
      texto: texto,
      categoria: document.getElementById('postCategoria').value,
      link: document.getElementById('postLink').value || null,
      midiaURL: finalMidiaURL,
      midiaTipo: midiaTipo,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp(),
      autor: auth.currentUser.displayName || 'Admin'
    });

    mostrarAlerta('alert-post', '‚úÖ Post publicado com sucesso!', 'success');
    
    // Limpa form
    document.getElementById('formPost').reset();
    removerArquivoUniversal();
    
    // Recarrega lista
    carregarPosts();

  } catch (error) {
    console.error('Erro ao publicar:', error);
    mostrarAlerta('alert-post', `‚ùå Erro: ${error.message}`, 'error');
    uploadProgressUniversal.style.display = 'none';
    if (arquivoUniversal) uploadPreviewUniversal.style.display = 'block';
  }

  btnPost.disabled = false;
  btnPost.textContent = 'Publicar Post';
});


async function carregarPosts() {
  const container = document.getElementById('posts-list');
  
  try {
    const snapshot = await db.collection('posts')
      .orderBy('criadoEm', 'desc')
      .limit(20)
      .get();

    if (snapshot.empty) {
      container.innerHTML = '<p style="text-align:center;color:var(--text-muted)">Nenhum post publicado ainda.</p>';
      return;
    }

    let html = '';
    snapshot.forEach(doc => {
      const post = doc.data();
      const data = post.criadoEm ? post.criadoEm.toDate().toLocaleDateString('pt-BR') : 'Agora';
      
      // M√≠dia (imagem, v√≠deo ou PDF)
      let midiaHTML = '';
      if (post.midiaURL && post.midiaTipo === 'video') {
        let videoEmbedURL = post.midiaURL;
        
        if (post.midiaURL.includes('drive.google.com')) {
          const fileIdMatch = post.midiaURL.match(/\/d\/([a-zA-Z0-9_-]+)/);
          if (fileIdMatch) {
            videoEmbedURL = `https://drive.google.com/file/d/${fileIdMatch[1]}/preview`;
          }
        } else if (post.midiaURL.includes('streamable.com')) {
          videoEmbedURL = post.midiaURL + '/e';
        }
        
        midiaHTML = `<div class="post-video" style="position: relative; width: 100%; padding-bottom: 56.25%; background: #000; border-radius: 8px; overflow: hidden; margin-bottom: 12px;">
          <iframe src="${videoEmbedURL}" frameborder="0" allowfullscreen allow="autoplay; fullscreen" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></iframe>
        </div>`;
      } else if (post.midiaURL && post.midiaTipo === 'pdf') {
        midiaHTML = `<div style="margin-bottom: 12px; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 8px; text-align: center;">
          <span style="font-size: 48px;">üìÑ</span>
          <p style="margin: 8px 0; font-weight: 600;">Arquivo anexado</p>
          <a href="${post.midiaURL}" target="_blank" class="btn btn-sm" style="display: inline-block; padding: 8px 16px; background: var(--accent); color: #000; text-decoration: none; border-radius: 6px; font-weight: 600;">üì• Baixar Arquivo</a>
        </div>`;
      } else if (post.midiaURL || post.imagemURL) {
        const imgURL = post.midiaURL || post.imagemURL;
        midiaHTML = `<img src="${imgURL}" class="post-image" alt="${post.titulo}">`;
      }
      
      html += `
        <div class="post-item">
          ${midiaHTML}
          <div class="post-content">
            <div class="post-title">${post.titulo}</div>
            <div class="post-text">${post.texto.substring(0, 150)}${post.texto.length > 150 ? '...' : ''}</div>
            <div class="post-meta">
              üìÖ ${data} ‚Ä¢ üìÅ ${post.categoria} ‚Ä¢ ‚úçÔ∏è ${post.autor}
              ${post.midiaTipo === 'video' ? ' ‚Ä¢ üé• V√≠deo' : ''}
              ${post.midiaTipo === 'pdf' ? ' ‚Ä¢ üìÑ Arquivo' : ''}
            </div>
            <div class="post-actions">
              <button class="btn btn-sm" onclick="toggleComentariosAdmin('${doc.id}')" style="background: var(--blue); color: #fff; margin-right: 8px;">üí¨ Coment√°rios (<span id="count-admin-${doc.id}">0</span>)</button>
              <button class="btn btn-sm btn-danger" onclick="deletarPost('${doc.id}')">üóëÔ∏è Excluir Post</button>
            </div>
            
            <!-- SE√á√ÉO DE COMENT√ÅRIOS -->
            <div class="comentarios-section" id="comentarios-admin-${doc.id}" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
              <div class="comentarios-lista" id="lista-admin-${doc.id}">
                <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                  Carregando coment√°rios...
                </div>
              </div>
              
              <!-- FORM DE NOVO COMENT√ÅRIO (ADMIN) -->
              <div class="comentario-form" style="margin-top: 16px;">
                <textarea 
                  id="texto-admin-${doc.id}" 
                  placeholder="Escreva seu coment√°rio como admin..." 
                  style="width: 100%; min-height: 80px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; padding: 12px; color: var(--text); font-family: inherit; font-size: 14px; resize: vertical;"
                ></textarea>
                <button 
                  class="btn btn-sm" 
                  onclick="enviarComentarioAdmin('${doc.id}')" 
                  style="margin-top: 8px; background: var(--accent); color: #000;"
                >
                  Enviar Coment√°rio
                </button>
              </div>
            </div>
          </div>
        </div>`;
    });

    container.innerHTML = html;
    
    // Carregar contadores de coment√°rios
    setTimeout(async () => {
      const snapshot = await db.collection('posts').orderBy('criadoEm', 'desc').limit(20).get();
      for (const doc of snapshot.docs) {
        const comentariosSnap = await db.collection('posts').doc(doc.id).collection('comentarios').get();
        const countElement = document.getElementById(`count-admin-${doc.id}`);
        if (countElement) countElement.textContent = comentariosSnap.size;
      }
    }, 500);

  } catch (error) {
    console.error('Erro ao carregar posts:', error);
    container.innerHTML = '<p style="color:var(--red)">Erro ao carregar posts</p>';
  }
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMENT√ÅRIOS NA LISTA DE POSTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

async function toggleComentariosAdmin(postId) {
  const section = document.getElementById(`comentarios-admin-${postId}`);
  if (section.style.display === 'none') {
    section.style.display = 'block';
    await carregarComentariosAdminList(postId);
  } else {
    section.style.display = 'none';
  }
}

async function carregarComentariosAdminList(postId) {
  const lista = document.getElementById(`lista-admin-${postId}`);
  try {
    const snapshot = await db.collection('posts').doc(postId).collection('comentarios')
      .orderBy('criadoEm', 'asc').get();
    const countElement = document.getElementById(`count-admin-${postId}`);
    if (countElement) countElement.textContent = snapshot.size;
    if (snapshot.empty) {
      lista.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--text-muted);">Nenhum coment√°rio ainda.</p>';
      return;
    }
    let html = '';
    snapshot.forEach(doc => {
      const comentario = doc.data();
      const data = comentario.criadoEm ? comentario.criadoEm.toDate().toLocaleString('pt-BR', {day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit'}) : 'Agora';
      html += `<div style="background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
            <strong style="color: var(--accent); font-size: 13px;">${comentario.autor}</strong>
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: 11px; color: var(--text-muted);">${data}</span>
              <button onclick="deletarComentarioAdminList('${postId}', '${doc.id}')" style="background: none; border: none; color: var(--red); cursor: pointer; font-size: 14px; padding: 4px; opacity: 0.7;" title="Deletar">üóëÔ∏è</button>
            </div>
          </div>
          <p style="margin: 0; font-size: 14px; line-height: 1.6; color: var(--text);">${comentario.texto}</p>
        </div>`;
    });
    lista.innerHTML = html;
  } catch (error) {
    console.error('Erro:', error);
    lista.innerHTML = '<p style="color: var(--red);">Erro ao carregar</p>';
  }
}

async function enviarComentarioAdmin(postId) {
  const textarea = document.getElementById(`texto-admin-${postId}`);
  const texto = textarea.value.trim();
  if (!texto) { alert('Digite um coment√°rio!'); return; }
  try {
    const user = auth.currentUser;
    await db.collection('posts').doc(postId).collection('comentarios').add({
      texto, autor: user.displayName || 'Admin', autorId: user.uid,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp()
    });
    textarea.value = '';
    await carregarComentariosAdminList(postId);
  } catch (error) {
    console.error('Erro:', error);
    alert('Erro ao enviar coment√°rio');
  }
}

async function deletarComentarioAdminList(postId, comentarioId) {
  if (!confirm('Deletar este coment√°rio?')) return;
  try {
    await db.collection('posts').doc(postId).collection('comentarios').doc(comentarioId).delete();
    await carregarComentariosAdminList(postId);
  } catch (error) {
    console.error('Erro:', error);
    alert('Erro ao deletar');
  }
}


async function deletarPost(postId) {
  if (!confirm('Deseja realmente excluir este post?')) return;

  try {
    // Buscar dados do post antes de deletar
    const postDoc = await db.collection('posts').doc(postId).get();
    const postData = postDoc.data();
    
    // Deletar do Firestore
    await db.collection('posts').doc(postId).delete();
    
    // Se tinha arquivo no Drive, tentar deletar (mas n√£o bloquear se falhar)
    if (postData && postData.midiaURL && postData.midiaURL.includes('drive.google.com')) {
      try {
        const fileIdMatch = postData.midiaURL.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (fileIdMatch) {
          const fileId = fileIdMatch[1];
          
          // Chamar Apps Script para deletar arquivo
          const params = new URLSearchParams();
          params.append('acao', 'deletarArquivo');
          params.append('fileId', fileId);
          
          await fetch('https://script.google.com/macros/s/AKfycbxp_oeOJcpv-YqaQLVk3lb7DMsuHdbLdkKO32c0rezjEmPa7pQy06JzHOdoOga43l-R/exec', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: params.toString()
          });
          
          console.log('üóëÔ∏è Arquivo deletado do Drive:', fileId);
        }
      } catch (driveError) {
        console.log('‚ö†Ô∏è N√£o foi poss√≠vel deletar arquivo do Drive:', driveError);
        // N√£o mostrar erro pro usu√°rio, post j√° foi deletado
      }
    }
    
    mostrarAlerta('alert-post', '‚úÖ Post exclu√≠do', 'success');
    carregarPosts();
  } catch (error) {
    console.error('Erro ao excluir:', error);
    mostrarAlerta('alert-post', '‚ùå Erro ao excluir post', 'error');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// USU√ÅRIOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function carregarUsuarios() {
  try {
    const snapshot = await db.collection('users').get();
    
    let pendentes = '';
    let aprovados = '';
    
    snapshot.forEach(doc => {
      const user = doc.data();
      if (user.role === 'admin') return;
      
      const html = `
        <tr>
          <td>${user.nome}</td>
          <td>${user.email}</td>
          <td><span class="badge ${user.aprovado ? 'approved' : 'pending'}">${user.aprovado ? 'Aprovado' : 'Pendente'}</span></td>
          <td>
            ${!user.aprovado ? `
              <button class="btn btn-sm" onclick="aprovarUsuario('${doc.id}')">Aprovar</button>
              <button class="btn btn-sm btn-danger" onclick="rejeitarUsuario('${doc.id}')">Rejeitar</button>
            ` : `
              <button class="btn btn-sm btn-danger" onclick="revogarAprovacao('${doc.id}')">Revogar</button>
            `}
          </td>
        </tr>`;
      
      if (user.aprovado) {
        aprovados += html;
      } else {
        pendentes += html;
      }
    });

    document.getElementById('usuarios-pendentes').innerHTML = pendentes
      ? `<table><thead><tr><th>Nome</th><th>Email</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>${pendentes}</tbody></table>`
      : '<p style="text-align:center;color:var(--text-muted)">Nenhum usu√°rio pendente</p>';

    document.getElementById('usuarios-aprovados').innerHTML = aprovados
      ? `<table><thead><tr><th>Nome</th><th>Email</th><th>Status</th><th>A√ß√µes</th></tr></thead><tbody>${aprovados}</tbody></table>`
      : '<p style="text-align:center;color:var(--text-muted)">Nenhum aluno aprovado ainda</p>';

  } catch (error) {
    console.error('Erro ao carregar usu√°rios:', error);
  }
}

async function aprovarUsuario(uid) {
  try {
    await db.collection('users').doc(uid).update({ aprovado: true });
    mostrarAlerta('alert-aprovacao', '‚úÖ Usu√°rio aprovado!', 'success');
    carregarUsuarios();
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('alert-aprovacao', '‚ùå Erro ao aprovar', 'error');
  }
}

async function rejeitarUsuario(uid) {
  if (!confirm('Deseja rejeitar este usu√°rio? Ele ser√° exclu√≠do.')) return;
  
  try {
    await db.collection('users').doc(uid).delete();
    mostrarAlerta('alert-aprovacao', '‚úÖ Usu√°rio rejeitado', 'success');
    carregarUsuarios();
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('alert-aprovacao', '‚ùå Erro ao rejeitar', 'error');
  }
}

async function revogarAprovacao(uid) {
  if (!confirm('Deseja revogar a aprova√ß√£o deste usu√°rio?')) return;
  
  try {
    await db.collection('users').doc(uid).update({ aprovado: false });
    mostrarAlerta('alert-aprovacao', '‚úÖ Aprova√ß√£o revogada', 'success');
    carregarUsuarios();
  } catch (error) {
    console.error('Erro:', error);
    mostrarAlerta('alert-aprovacao', '‚ùå Erro ao revogar', 'error');
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FOTOS DE TRADES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let tradeFile = null;
const SPREADSHEET_ID = '1iawimQW3a9bWC4-pTJxvnu3ED62AcN-TjthXwpaIQ10';

// Configurar drag and drop para fotos de trades
const uploadAreaTrade = document.getElementById('uploadAreaTrade');
const fileInputTrade = document.getElementById('fileInputTrade');

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  uploadAreaTrade.addEventListener(eventName, (e) => {
    e.preventDefault();
    e.stopPropagation();
  });
});

['dragenter', 'dragover'].forEach(eventName => {
  uploadAreaTrade.addEventListener(eventName, () => {
    uploadAreaTrade.style.borderColor = 'var(--accent)';
    uploadAreaTrade.style.background = 'rgba(34,197,94,0.05)';
  });
});

['dragleave', 'drop'].forEach(eventName => {
  uploadAreaTrade.addEventListener(eventName, () => {
    uploadAreaTrade.style.borderColor = 'var(--border)';
    uploadAreaTrade.style.background = 'transparent';
  });
});

uploadAreaTrade.addEventListener('drop', (e) => {
  const files = e.dataTransfer.files;
  if (files.length > 0) processarArquivoTrade(files[0]);
});

uploadAreaTrade.addEventListener('click', () => fileInputTrade.click());

fileInputTrade.addEventListener('change', (e) => {
  if (e.target.files.length > 0) processarArquivoTrade(e.target.files[0]);
});

function processarArquivoTrade(file) {
  if (!file.type.startsWith('image/')) {
    alert('‚ùå Por favor, selecione apenas imagens');
    return;
  }

  if (file.size > 10 * 1024 * 1024) {
    alert('‚ùå Imagem muito grande. M√°ximo 10MB');
    return;
  }

  tradeFile = file;

  const reader = new FileReader();
  reader.onload = (e) => {
    document.getElementById('previewImgTrade').src = e.target.result;
    document.getElementById('uploadPlaceholderTrade').style.display = 'none';
    document.getElementById('uploadPreviewTrade').style.display = 'block';
  };
  reader.readAsDataURL(file);
}

function removerImagemTrade() {
  tradeFile = null;
  fileInputTrade.value = '';
  document.getElementById('uploadPlaceholderTrade').style.display = 'block';
  document.getElementById('uploadPreviewTrade').style.display = 'none';
}

// Upload de foto do trade
document.getElementById('formFotoTrade').addEventListener('submit', async (e) => {
  e.preventDefault();

  if (!tradeFile) {
    mostrarAlerta('alert-foto-trade', '‚ùå Selecione uma foto', 'error');
    return;
  }

  const dia = parseInt(document.getElementById('diaDoTrade').value);
  const mes = parseInt(document.getElementById('mesDoTrade').value);
  const ano = parseInt(document.getElementById('anoDoTrade').value);
  
  if (dia < 1 || dia > 31) {
    mostrarAlerta('alert-foto-trade', '‚ùå Dia inv√°lido (1-31)', 'error');
    return;
  }

  const btnFotoTrade = document.getElementById('btnFotoTrade');
  btnFotoTrade.disabled = true;
  btnFotoTrade.textContent = 'Enviando...';

  try {
    document.getElementById('uploadPreviewTrade').style.display = 'none';
    document.getElementById('uploadProgressTrade').style.display = 'block';
    document.getElementById('uploadProgressTextTrade').textContent = 'Fazendo upload para Google Drive...';

    // Converte imagem para base64
    const reader = new FileReader();
    const base64Promise = new Promise((resolve) => {
      reader.onload = (e) => resolve(e.target.result);
      reader.readAsDataURL(tradeFile);
    });
    
    const imagemBase64 = await base64Promise;

    console.log('üì∏ Enviando foto do trade...');
    console.log('  Dia:', dia);
    console.log('  M√™s:', mes);
    console.log('  Ano:', ano);

    // Envia para a API do Google Apps Script
    const formData = new FormData();
    formData.append('dia', dia);
    formData.append('mes', mes);
    formData.append('ano', ano);
    formData.append('imagem', imagemBase64);

    const response = await fetch('https://script.google.com/macros/s/AKfycbxp_oeOJcpv-YqaQLVk3lb7DMsuHdbLdkKO32c0rezjEmPa7pQy06JzHOdoOga43l-R/exec', {
      method: 'POST',
      body: formData
    });

    const resultado = await response.json();

    if (resultado.success) {
      console.log('‚úÖ Foto salva com sucesso!');
      console.log('  ID da Foto:', resultado.fotoId);
      console.log('  Nome:', resultado.nomeArquivo);
      console.log('  Linha atualizada:', resultado.linha);
      
      mostrarAlerta('alert-foto-trade', `‚úÖ Foto salva com sucesso! (Drive + Planilha linha ${resultado.linha})`, 'success');
    } else {
      throw new Error(resultado.error || 'Erro desconhecido');
    }
    
    // Limpa form
    document.getElementById('formFotoTrade').reset();
    removerImagemTrade();

  } catch (error) {
    console.error('‚ùå Erro ao salvar foto:', error);
    mostrarAlerta('alert-foto-trade', `‚ùå Erro ao salvar foto: ${error.message}`, 'error');
    document.getElementById('uploadPreviewTrade').style.display = 'block';
    document.getElementById('uploadProgressTrade').style.display = 'none';
  }

  btnFotoTrade.disabled = false;
  btnFotoTrade.textContent = 'Salvar Foto do Trade';
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORMUL√ÅRIO DE DADOS DO TRADE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Calcular semana do m√™s baseado no dia
function calcularSemanaMes(dia) {
  if (dia <= 7) return 'SEMANA 1';
  if (dia <= 14) return 'SEMANA 2';
  if (dia <= 21) return 'SEMANA 3';
  if (dia <= 28) return 'SEMANA 4';
  return 'SEMANA 5';
}

// Atualizar semana quando mudar o dia
document.getElementById('diaData').addEventListener('input', (e) => {
  const dia = parseInt(e.target.value);
  if (dia >= 1 && dia <= 31) {
    document.getElementById('semana').value = calcularSemanaMes(dia);
  } else {
    document.getElementById('semana').value = '';
  }
});

document.getElementById('formTradeData').addEventListener('submit', async (e) => {
  e.preventDefault();

  const btnTradeData = document.getElementById('btnTradeData');
  btnTradeData.disabled = true;
  btnTradeData.textContent = 'Salvando...';

  try {
    const dia = parseInt(document.getElementById('diaData').value);
    const mes = parseInt(document.getElementById('mesData').value);
    const ano = parseInt(document.getElementById('anoData').value);
    const semana = document.getElementById('semana').value.trim() || calcularSemanaMes(dia);
    const alvo = document.getElementById('alvo').value.trim() || 'NASDAQ';
    const pontos = parseInt(document.getElementById('pontos').value);
    const trades = parseInt(document.getElementById('trades').value);
    const gains = parseInt(document.getElementById('gains').value);
    const stops = parseInt(document.getElementById('stops').value);
    const breakeven = parseInt(document.getElementById('breakeven').value);

    console.log('üìä Salvando dados do trade na planilha...');
    console.log('  Data:', `${dia}/${mes}/${ano}`);
    console.log('  Semana:', semana);
    console.log('  Alvo:', alvo);
    console.log('  Pontos:', pontos);

    // Envia para Google Sheets
    const params = new URLSearchParams();
    params.append('acao', 'salvarTrade');
    params.append('dia', dia);
    params.append('mes', mes);
    params.append('ano', ano);
    params.append('semana', semana);
    params.append('alvo', alvo);
    params.append('pontos', pontos);
    params.append('trades', trades);
    params.append('gains', gains);
    params.append('stops', stops);
    params.append('breakeven', breakeven);

    const response = await fetch('https://script.google.com/macros/s/AKfycbxp_oeOJcpv-YqaQLVk3lb7DMsuHdbLdkKO32c0rezjEmPa7pQy06JzHOdoOga43l-R/exec', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: params.toString()
    });
    
    const resultado = await response.json();
    console.log('üì• Resposta completa:', JSON.stringify(resultado));
    console.log('üì• resultado.success:', resultado.success);
    console.log('üì• resultado.linha:', resultado.linha);
    console.log('üì• resultado.data:', resultado.data);

    if (resultado.success) {
      const linhaNumero = resultado.linha || 'desconhecida';
      console.log('‚úÖ Dados salvos na linha:', linhaNumero);
      
      mostrarAlerta('alert-trade-data', `‚úÖ Dados salvos com sucesso! (Planilha linha ${linhaNumero})`, 'success');
      
      // Limpa form
      document.getElementById('formTradeData').reset();
      
      // Redefine data para hoje
      const hoje = new Date();
      document.getElementById('diaData').value = hoje.getDate();
      document.getElementById('mesData').value = hoje.getMonth() + 1;
      document.getElementById('anoData').value = hoje.getFullYear();
      document.getElementById('semana').value = calcularSemanaMes(hoje.getDate());
      document.getElementById('alvo').value = 'NASDAQ';
    } else {
      throw new Error(resultado.error || 'Erro desconhecido');
    }

  } catch (error) {
    console.error('‚ùå Erro ao salvar:', error);
    mostrarAlerta('alert-trade-data', `‚ùå Erro ao salvar: ${error.message}`, 'error');
  }

  btnTradeData.disabled = false;
  btnTradeData.textContent = 'Salvar na Planilha';
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VER POSTS (ADMIN)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let todosOsPostsAdmin = [];
let categoriaAtualAdmin = 'todos';

const categoriaIcons = {
  'sala-ao-vivo': 'üî¥',
  'materiais': 'üìö',
  'analise': 'üìà',
  'tutorial': 'üéì',
  'noticia': 'üì∞',
  'link': 'üîó'
};

async function carregarPostsAdmin() {
  try {
    const snapshot = await db.collection('posts')
      .orderBy('criadoEm', 'desc')
      .get();

    todosOsPostsAdmin = [];
    snapshot.forEach(doc => {
      todosOsPostsAdmin.push({ id: doc.id, ...doc.data() });
    });

    renderizarPostsAdmin();
  } catch (error) {
    console.error('Erro ao carregar posts:', error);
    document.getElementById('posts-admin-list').innerHTML = '<p style="color:var(--red)">Erro ao carregar posts</p>';
  }
}

function renderizarPostsAdmin() {
  const container = document.getElementById('posts-admin-list');
  
  let postsFiltrados = todosOsPostsAdmin;
  if (categoriaAtualAdmin !== 'todos') {
    postsFiltrados = todosOsPostsAdmin.filter(p => p.categoria === categoriaAtualAdmin);
  }

  if (postsFiltrados.length === 0) {
    container.innerHTML = '<p style="text-align:center;padding:40px;color:var(--text-muted)">Nenhum post nesta categoria</p>';
    return;
  }

  let html = '';
  postsFiltrados.forEach(post => {
    const data = post.criadoEm 
      ? post.criadoEm.toDate().toLocaleDateString('pt-BR', { day: '2-digit', month: 'short', year: 'numeric' })
      : 'Agora';
    
    const icon = categoriaIcons[post.categoria] || 'üìÑ';

    let midiaHTML = '';
    if (post.midiaURL && post.midiaTipo === 'video') {
      midiaHTML = `
        <div class="post-video" style="width:100%; aspect-ratio:16/9; margin-bottom: 12px;">
          <iframe 
            src="${post.midiaURL}/e" 
            frameborder="0" 
            allowfullscreen 
            style="width:100%;height:100%;border-radius:8px;">
          </iframe>
        </div>`;
    } else if (post.midiaURL && post.midiaTipo === 'pdf') {
      midiaHTML = `
        <div style="padding: 24px; background: rgba(255,255,255,0.05); border-radius: 12px; text-align: center; margin-bottom: 16px;">
          <span style="font-size: 64px;">üìÑ</span>
          <p style="margin: 12px 0; font-weight: 600; font-size: 16px;">Arquivo anexado</p>
          <a href="${post.midiaURL}" target="_blank" class="btn" style="display: inline-block; padding: 12px 24px; background: var(--accent); color: #000; text-decoration: none; border-radius: 8px; font-weight: 600;">üì• Baixar Arquivo</a>
        </div>`;
    } else if (post.midiaURL || post.imagemURL) {
      const imgURL = post.midiaURL || post.imagemURL;
      midiaHTML = `<img src="${imgURL}" class="post-image" alt="${post.titulo}" onclick="window.open('${imgURL}', '_blank')" style="width: 100%; height: 250px; object-fit: cover; cursor: pointer; border-radius: 12px 12px 0 0; transition: transform .3s;">`;
    }

    html += `
      <div class="post-card" data-categoria="${post.categoria}" data-post-id="${post.id}" style="background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        ${midiaHTML}
        <div class="post-content" style="padding: 24px;">
          <div class="post-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <span class="post-category" style="font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--accent); background: rgba(34,197,94,0.15); padding: 6px 12px; border-radius: 8px;">${icon} ${post.categoria}</span>
            <span class="post-date" style="font-size: 12px; color: var(--text-muted);">üìÖ ${data}</span>
          </div>
          <h3 class="post-title" style="font-size: 22px; font-weight: 700; margin-bottom: 12px;">${post.titulo}</h3>
          <p class="post-text" style="font-size: 15px; color: var(--text-muted); line-height: 1.8; margin-bottom: 20px;">${post.texto}</p>
          <div class="post-footer" style="display: flex; gap: 8px; flex-wrap: wrap;">
            ${post.link ? `<a href="${post.link}" target="_blank" class="btn btn-primary" style="padding: 10px 18px; border-radius: 8px; background: var(--accent); color: #000; text-decoration: none; display: inline-flex; align-items: center; gap: 6px;">Acessar Link üîó</a>` : ''}
            <button class="btn btn-secondary" onclick="toggleComentariosAdmin('${post.id}')" style="padding: 10px 18px; border-radius: 8px; background: rgba(255,255,255,0.08); color: var(--text); border: 1px solid var(--border);">
              üí¨ Coment√°rios (<span id="count-${post.id}">0</span>)
            </button>
          </div>
          
          <!-- SE√á√ÉO DE COMENT√ÅRIOS -->
          <div class="comentarios-section" id="comentarios-${post.id}" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
            <div class="comentarios-lista" id="lista-${post.id}">
              <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                Carregando coment√°rios...
              </div>
            </div>
            
            <!-- FORM DE NOVO COMENT√ÅRIO (ADMIN) -->
            <div class="comentario-form" style="margin-top: 16px;">
              <textarea 
                id="texto-${post.id}" 
                placeholder="Escreva seu coment√°rio como admin..." 
                style="width: 100%; min-height: 100px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; padding: 14px; color: var(--text); font-family: inherit; font-size: 14px; resize: vertical; transition: all .2s;"
              ></textarea>
              <button 
                class="btn btn-primary" 
                onclick="enviarComentarioAdmin('${post.id}')" 
                style="margin-top: 8px; background: var(--accent); color: #000; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;"
              >
                Enviar Coment√°rio
              </button>
            </div>
          </div>
        </div>
      </div>`;
  });

  container.innerHTML = html;
  setTimeout(carregarContadoresAdmin, 500);
}

function filtrarPostsAdmin(categoria, btn) {
  document.querySelectorAll('.filter-btn').forEach(b => {
    b.classList.remove('active');
    b.style.background = 'rgba(255,255,255,0.05)';
    b.style.borderColor = 'var(--border)';
    b.style.color = 'var(--text)';
  });
  
  if (btn) {
    btn.classList.add('active');
    btn.style.background = 'var(--accent)';
    btn.style.borderColor = 'var(--accent)';
    btn.style.color = '#000';
  }
  
  categoriaAtualAdmin = categoria;
  renderizarPostsAdmin();
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INICIALIZA√á√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Verificar autentica√ß√£o
auth.onAuthStateChanged(async (user) => {
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  
  // Verificar se √© admin
  try {
    const userDoc = await db.collection('usuarios').doc(user.uid).get();
    const userData = userDoc.data();
    
    if (!userData) {
      console.log('‚ùå Usu√°rio n√£o encontrado no Firestore');
      alert('Usu√°rio n√£o encontrado no banco de dados!');
      auth.signOut();
      window.location.href = 'login.html';
      return;
    }
    
    console.log('üë§ Dados do usu√°rio:', userData);
    console.log('üìã Tipo:', userData.tipo);
    console.log('‚úÖ Aprovado:', userData.aprovado);
    
    // Verificar se √© admin (aceita 'admin' ou 'administrador')
    const isAdmin = userData.tipo === 'admin' || userData.tipo === 'administrador' || userData.admin === true;
    
    if (!isAdmin) {
      console.log('‚ùå N√ÉO √â ADMIN');
      alert('Voc√™ n√£o tem permiss√£o de administrador!\n\nTipo de conta: ' + (userData.tipo || 'n√£o definido'));
      auth.signOut();
      window.location.href = 'login.html';
      return;
    }
    
    console.log('‚úÖ Admin verificado com sucesso!');
    
    // Carregar dados iniciais
    carregarPosts();
    carregarUsuarios();
    
  } catch (error) {
    console.error('Erro ao verificar permiss√£o:', error);
    alert('Erro ao verificar permiss√µes');
    auth.signOut();
    window.location.href = 'login.html';
  }
});

</script>
</body>
</html>
