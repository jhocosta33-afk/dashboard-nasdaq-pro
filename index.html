<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard NASDAQ PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ================= BASE ================= */
:root{
 --bg:#020617;
 --card:#050b1a;
 --border:rgba(255,255,255,.08);
 --text:#e5e7eb;
 --muted:#9ca3af;
 --green:#22c55e;
 --red:#ef4444;
 --yellow:#facc15;
 --blue:#93c5fd;
}

*{ box-sizing:border-box; font-family:Inter,system-ui }

body{
 margin:0;
 background:radial-gradient(circle at top,#334155 0%,#1e293b 35%,#020617 75%);
 color:var(--text);
}

.container{ max-width:1600px; margin:auto; padding:24px }

/* HEADER */
.header{ margin-bottom:36px }
.header img{ height:84px }
.dashboard-title{ margin-top:20px;font-size:22px;letter-spacing:4px;font-weight:900;color:var(--blue) }

/* FILTROS */
.filters{ display:flex; gap:12px; margin-bottom:24px; flex-wrap:wrap }
select{
 background:var(--card); color:var(--text);
 border:1px solid var(--border); border-radius:14px;
 padding:12px 16px; font-size:15px; width:220px
}

/* KPIs */
.kpis{
 display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
 gap:16px; margin-bottom:28px
}
.kpi{
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border); border-radius:18px; padding:18px
}
.kpi span{ color:var(--muted); font-size:13px; text-transform:uppercase }
.kpi strong{ display:block; margin-top:8px; font-size:28px }

/* GRÁFICOS */
.cards{ display:grid; grid-template-columns:1.3fr 1fr; gap:16px; margin-bottom:24px }
.card{
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border); border-radius:22px;
 padding:18px; height:420px; display:flex; flex-direction:column
}
.chart-wrap{ flex:1; position:relative }
canvas{ width:100%!important; height:100%!important }

/* TABELA */
table{ width:100%; min-width:900px; border-collapse:collapse }
th,td{ padding:12px; text-align:center; border-bottom:1px solid var(--border) }
th{ color:var(--blue) }
tr.total{ background:rgba(34,197,94,.08); font-weight:700 }

/* CALENDÁRIO */
.calendar-wrapper{
 margin-top:28px; background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border); border-radius:22px; padding:18px
}
.calendar-header,.calendar-grid{
 display:grid; grid-template-columns:repeat(7,1fr); gap:12px; text-align:center
}
.day{
 background:linear-gradient(180deg,#052e2b,#020617);
 border:1px solid var(--border); border-radius:16px;
 min-height:120px; padding:10px
}
.day.positive{ background:linear-gradient(180deg,#053a32,#020617) }
.day.negative{ background:linear-gradient(180deg,#3a0505,#020617) }
.empty{ background:transparent; border:none }
</style>
</head>

<body>
<div class="container">

<div class="header">
 <img src="logo.png">
 <div class="dashboard-title">DASHBOARD</div>
</div>

<div class="filters">
 <select id="filtroAno"></select>
 <select id="filtroMes"></select>
 <select id="filtroSemana"></select>
</div>

<div class="kpis">
 <div class="kpi"><span>Trades</span><strong id="kTrades">0</strong></div>
 <div class="kpi"><span>Pontos</span><strong id="kPontos">0</strong></div>
 <div class="kpi"><span>Gains</span><strong id="kGains" style="color:var(--green)">0</strong></div>
 <div class="kpi"><span>Stops</span><strong id="kStops" style="color:var(--red)">0</strong></div>
 <div class="kpi"><span>0x0</span><strong id="kZero" style="color:var(--yellow)">0</strong></div>
 <div class="kpi"><span>Assertividade</span><strong id="kAcc">0%</strong></div>
</div>

<div class="cards">
 <div class="card"><strong>Evolução</strong><div class="chart-wrap"><canvas id="chartAcumulado"></canvas></div></div>
 <div class="card"><strong>Gains x Stops</strong><div class="chart-wrap"><canvas id="chartBar"></canvas></div></div>
</div>

<div class="calendar-wrapper">
 <strong>Calendário Operacional</strong>
 <div class="calendar-header">
  <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>Sáb</div>
 </div>
 <div class="calendar-grid" id="calendar"></div>
</div>

</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv";
let dadosCSV=[],chartAcumulado,chartBar;

async function loadCSV(){
 const r=await fetch(CSV_URL,{cache:"no-store"});
 parseCSV(await r.text());
}

function parseCSV(t){
 const rows=t.trim().split(/\r?\n/); rows.shift();
 dadosCSV=rows.map(r=>{
  const c=r.split(","); const [d,m,a]=c[0].split("/");
  return{ dia:c[0], data:new Date(a,m-1,d), semana:c[1], ano:a, mes:m,
   pontos:+c[3]||0, trades:+c[4]||0, gain:+c[5]||0, stop:+c[6]||0, zero:+c[7]||0 };
 });
 initFiltros();
}

function initFiltros(){
 const anos=[...new Set(dadosCSV.map(d=>d.ano))].sort();
 filtroAno.innerHTML=anos.map(a=>`<option>${a}</option>`).join("");
 filtroAno.value=anos.at(-1);
 filtroAno.onchange=()=>{initMeses();atualizar()}
 initMeses();
}

function initMeses(){
 const meses=[...new Set(dadosCSV.filter(d=>d.ano===filtroAno.value).map(d=>d.mes))];
 filtroMes.innerHTML='<option value="ALL">Todos</option>'+meses.map(m=>`<option>${m}</option>`).join("");
 filtroMes.value="ALL";
 filtroMes.onchange=()=>{initSemanas();atualizar()}
 initSemanas();
}

function initSemanas(){
 const semanas=[...new Set(dadosCSV.map(d=>d.semana))];
 filtroSemana.innerHTML='<option value="ALL">Todas</option>'+semanas.map(s=>`<option>${s}</option>`).join("");

 /* ===== ALTERAÇÃO: SEMANA VIGENTE ===== */
 const hoje=new Date().toDateString();
 const atual=dadosCSV.find(d=>d.data.toDateString()===hoje);
 filtroSemana.value=atual?atual.semana:"ALL";
 /* ==================================== */

 filtroSemana.onchange=atualizar;
 atualizar();
}

function atualizar(){
 const f=dadosCSV.filter(d=>
  d.ano===filtroAno.value &&
  (filtroMes.value==="ALL"||d.mes===filtroMes.value) &&
  (filtroSemana.value==="ALL"||d.semana===filtroSemana.value)
 );
 renderKPIs(f); renderCalendario(f);
}

function renderKPIs(f){
 let g=0,s=0,p=0,t=0,z=0;
 f.forEach(d=>{g+=d.gain;s+=d.stop;p+=d.pontos;t+=d.trades;z+=d.zero});
 kTrades.textContent=t; kPontos.textContent=p;
 kGains.textContent=g; kStops.textContent=s; kZero.textContent=z;
 kAcc.textContent=(g+s)?Math.round(g/(g+s)*100)+"%":"0%";
}

function renderCalendario(f){
 const c=document.getElementById("calendar"); c.innerHTML="";
 if(!f.length)return;
 const a=f[0].data.getFullYear(),m=f[0].data.getMonth();
 const p=new Date(a,m,1).getDay(),u=new Date(a,m+1,0).getDate();
 for(let i=0;i<p;i++)c.innerHTML+=`<div class="day empty"></div>`;
 for(let d=1;d<=u;d++){
  const r=f.find(x=>x.data.getDate()===d);
  c.innerHTML+=`<div class="day ${r?(r.pontos>0?'positive':'negative'):''}">
   <div>${d}</div><div>${r?r.pontos:''}</div></div>`;
 }
}

loadCSV();
</script>
</body>
</html>
