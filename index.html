<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard NASDAQ PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* === ESTILO ORIGINAL PRESERVADO === */
:root{
 --bg:#020617;
 --card:#050b1a;
 --border:rgba(255,255,255,.08);
 --text:#e5e7eb;
 --muted:#9ca3af;
 --green:#22c55e;
 --red:#ef4444;
 --yellow:#facc15;
}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
 margin:0;
 background:radial-gradient(circle at top,#0b1f4d,#020617 70%);
 color:var(--text);
}
.container{
 max-width:1600px;
 margin:auto;
 padding:24px;
}
.filters{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px}
select{
 background:var(--card);
 color:var(--text);
 border:1px solid var(--border);
 border-radius:12px;
 padding:12px 16px;
 font-size:15px;
 width:220px;
}
select:disabled{opacity:.5}
</style>
</head>

<body>
<div class="container">

<div class="filters">
 <select id="filtroAno"></select>
 <select id="filtroMes"></select>
 <select id="filtroSemana"></select>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv";

const nomesMeses={
 "01":"Janeiro","02":"Fevereiro","03":"Março","04":"Abril",
 "05":"Maio","06":"Junho","07":"Julho","08":"Agosto",
 "09":"Setembro","10":"Outubro","11":"Novembro","12":"Dezembro"
};

let data=[];

/* ===== CSV ROBUSTO ===== */
async function loadCSV(){
 const res=await fetch(CSV_URL,{cache:"no-store"});
 const text=await res.text();
 parseCSV(text);
}

function parseCSV(text){
 const linhas=text.trim().split(/\r?\n/);
 const separador=linhas[0].includes(";")?";":",";

 linhas.shift(); // remove cabeçalho

 data=linhas.map(l=>{
  const c=l.split(separador);

  const dataStr=c[0]?.trim(); // DD/MM/YYYY
  if(!dataStr) return null;

  return{
   data:dataStr,
   semana:c[1]?.trim(),
   ativo:c[2]?.trim(),
   pontos:+c[3]||0,
   trades:+c[4]||0,
   gain:+c[5]||0,
   stop:+c[6]||0,
   zero:+c[7]||0,
   mes:dataStr.substring(3,5),
   ano:dataStr.substring(6,10)
  };
 }).filter(Boolean);

 initFiltros();
}

/* ===== FILTROS ===== */
function initFiltros(){
 const hoje=new Date();
 const anoAtual=String(hoje.getFullYear());
 const mesAtual=String(hoje.getMonth()+1).padStart(2,"0");

 const anos=[...new Set(data.map(d=>d.ano))].sort();
 filtroAno.innerHTML=anos.map(a=>`<option>${a}</option>`).join("");
 filtroAno.value=anos.includes(anoAtual)?anoAtual:anos.at(-1);

 filtroAno.onchange=()=>{initMeses();};

 initMeses(mesAtual);
}

function initMeses(mesAtual){
 const meses=[...new Set(
  data.filter(d=>d.ano===filtroAno.value).map(d=>d.mes)
 )];

 filtroMes.innerHTML=
  `<option value="ALL">Todos os meses</option>`+
  meses.map(m=>`<option value="${m}">${nomesMeses[m]}</option>`).join("");

 filtroMes.value=meses.includes(mesAtual)?mesAtual:"ALL";

 filtroMes.onchange=()=>initSemanas();
 initSemanas();
}

function initSemanas(){
 if(filtroMes.value==="ALL"){
  filtroSemana.innerHTML='<option>Todas as semanas</option>';
  filtroSemana.disabled=true;
  return;
 }

 filtroSemana.disabled=false;

 const semanas=[...new Set(
  data.filter(d=>
   d.ano===filtroAno.value &&
   d.mes===filtroMes.value
  ).map(d=>d.semana)
 )];

 filtroSemana.innerHTML=
  '<option value="ALL">Todas as semanas</option>'+
  semanas.map(s=>`<option>${s}</option>`).join("");

 filtroSemana.value="ALL";
}

loadCSV();
</script>
</body>
</html>
