<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mentoria NasdaqPro | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#020617;
 --card:#050b1a;
 --border:rgba(255,255,255,.08);
 --text:#e5e7eb;
 --muted:#9ca3af;
 --green:#22c55e;
 --red:#ef4444;
 --yellow:#facc15;
 --blue:#7aa2ff;
}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
 margin:0;
 background:radial-gradient(circle at top,#0b1f4d,#020617 70%);
 color:var(--text);
}
.container{max-width:1600px;margin:auto;padding:28px}
.title{margin:18px 0 26px;font-size:20px;font-weight:900;letter-spacing:4px;color:var(--blue)}
.filters{display:flex;gap:14px;flex-wrap:wrap;margin-bottom:28px}
select{
 background:linear-gradient(180deg,#030712,#050b1a);
 color:var(--text);
 border:1px solid var(--border);
 border-radius:16px;
 padding:14px 18px;
 font-size:15px;
 width:220px;
}
.kpis{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
 gap:16px;
 margin-bottom:32px;
}
.kpi{
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border);
 border-radius:20px;
 padding:18px 20px;
}
.kpi span{color:var(--muted);font-size:13px}
.kpi strong{display:block;margin-top:6px;font-size:30px}
.cards{display:grid;grid-template-columns:1fr 1fr;gap:18px}
.card{
 background:linear-gradient(180deg,#050b1a,#030818);
 border:1px solid var(--border);
 border-radius:24px;
 padding:20px;
 height:440px;
 display:flex;
 flex-direction:column;
}
.chart-wrap{flex:1}
canvas{width:100%!important;height:100%!important}
@media(max-width:1000px){
 .cards{grid-template-columns:1fr}
 select{width:100%}
}
</style>
</head>

<body>
<div class="container">

<img src="logo.png" height="70">
<div class="title">DASHBOARD</div>

<div class="filters">
 <select id="fAno"><option value="">Ano</option></select>
 <select id="fMes"><option value="">MÃªs</option></select>
 <select id="fSemana"><option value="">Semana</option></select>
</div>

<div class="kpis">
 <div class="kpi"><span>Trades</span><strong id="kTrades">0</strong></div>
 <div class="kpi"><span>Pontos</span><strong id="kPontos">0</strong></div>
 <div class="kpi"><span>Gains</span><strong id="kGain" style="color:var(--green)">0</strong></div>
 <div class="kpi"><span>Stops</span><strong id="kStop" style="color:var(--red)">0</strong></div>
 <div class="kpi"><span>0x0</span><strong id="kZero" style="color:var(--yellow)">0</strong></div>
 <div class="kpi"><span>Assertividade</span><strong id="kAcc">0.0%</strong></div>
</div>

<div class="cards">
 <div class="card">
  <strong>ðŸ“ˆ BalanÃ§o de Pontos</strong>
  <div class="chart-wrap"><canvas id="chartLine"></canvas></div>
 </div>
 <div class="card">
  <strong>ðŸ“Š Gains x Stops x 0x0</strong>
  <div class="chart-wrap"><canvas id="chartBar"></canvas></div>
 </div>
</div>

</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv";
const meses={"01":"Janeiro","02":"Fevereiro","03":"MarÃ§o","04":"Abril","05":"Maio","06":"Junho","07":"Julho","08":"Agosto","09":"Setembro","10":"Outubro","11":"Novembro","12":"Dezembro"};

let dados=[],lineChart,barChart;
let totais={p:0,tr:0,g:0,s:0,z:0};

fetch(CSV_URL,{cache:"no-store"})
.then(r=>r.text())
.then(t=>{
 const rows=t.trim().split(/\r?\n/);
 rows.shift();

 dados=rows.map(r=>{
  const c=r.split(";");
  return{
   dia:c[0],
   semana:c[1],
   pontos:Number(c[3])||0,
   trades:Number(c[4])||0,
   gain:Number(c[5])||0,
   stop:Number(c[6])||0,
   zero:Number(c[7])||0,
   ano:c[0]?.slice(6,10),
   mes:c[0]?.slice(3,5)
  }
 });

 initFiltros();
 atualizar();
});

function initFiltros(){
 const anos=[...new Set(dados.map(d=>d.ano))];
 fAno.innerHTML='<option value="">Ano</option>'+anos.map(a=>`<option>${a}</option>`).join("");
 fAno.onchange=()=>{initMeses();atualizar()};
 initMeses();
}

function initMeses(){
 const m=[...new Set(dados.filter(d=>!fAno.value||d.ano==fAno.value).map(d=>d.mes))];
 fMes.innerHTML='<option value="">MÃªs</option>'+m.map(x=>`<option value="${x}">${meses[x]}</option>`).join("");
 fMes.onchange=()=>{initSemanas();atualizar()};
 initSemanas();
}

function initSemanas(){
 const s=[...new Set(dados.filter(d=>
  (!fAno.value||d.ano==fAno.value)&&(!fMes.value||d.mes==fMes.value)
 ).map(d=>d.semana))];
 fSemana.innerHTML='<option value="">Semana</option>'+s.map(x=>`<option>${x}</option>`).join("");
 fSemana.onchange=atualizar;
}

function atualizar(){
 const f=dados.filter(d=>
  (!fAno.value||d.ano==fAno.value)&&
  (!fMes.value||d.mes==fMes.value)&&
  (!fSemana.value||d.semana==fSemana.value)
 );

 totais={p:0,tr:0,g:0,s:0,z:0};
 f.forEach(d=>{
  totais.p+=d.pontos;
  totais.tr+=d.trades;
  totais.g+=d.gain;
  totais.s+=d.stop;
  totais.z+=d.zero;
 });

 kTrades.textContent=totais.tr;
 kPontos.textContent=totais.p;
 kGain.textContent=totais.g;
 kStop.textContent=totais.s;
 kZero.textContent=totais.z;

 const acc=totais.g+totais.s?((totais.g/(totais.g+totais.s))*100):0;
 kAcc.textContent=acc.toFixed(1)+"%";

 renderCharts(f);
}

function renderCharts(f){
 const ord=[...f].sort((a,b)=>new Date(a.dia.split("/").reverse().join("-"))-new Date(b.dia.split("/").reverse().join("-")));
 let acc=0,labels=[],series=[];
 ord.forEach(d=>{acc+=d.pontos;labels.push(d.dia);series.push(acc)});

 if(lineChart)lineChart.destroy();
 if(barChart)barChart.destroy();

 lineChart=new Chart(chartLine,{
  type:"line",
  data:{labels,datasets:[{data:series,fill:true,tension:.35,borderColor:"#22c55e",backgroundColor:"rgba(34,197,94,.18)"}]},
  options:{plugins:{legend:{display:false}},responsive:true,maintainAspectRatio:false}
 });

 barChart=new Chart(chartBar,{
  type:"bar",
  data:{labels:["Gain","Stop","0x0"],datasets:[{data:[totais.g,totais.s,totais.z],backgroundColor:["#22c55e","#ef4444","#facc15"],borderRadius:12}]},
  options:{plugins:{legend:{display:false}},responsive:true,maintainAspectRatio:false}
 });
}
</script>
</body>
</html>
