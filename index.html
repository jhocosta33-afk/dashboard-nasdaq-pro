<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard NASDAQ PRO - V2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#020617;
 --card:#050b1a;
 --border:rgba(255,255,255,.08);
 --text:#e5e7eb;
 --muted:#9ca3af;
 --green:#22c55e;
 --red:#ef4444;
 --yellow:#facc15;
 --blue:#93c5fd;
}

*{ box-sizing:border-box; font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont; }

body{
 margin:0;
 background:radial-gradient(circle at top,#0b1f4d,#020617 70%);
 color:var(--text);
 min-height: 100vh;
}

.container{ max-width:1600px; margin:auto; padding:clamp(16px,2vw,28px); animation:fadePage .6s ease; }

@keyframes fadeUp{ from{opacity:0; transform:translateY(14px)} to{opacity:1; transform:translateY(0)} }
@keyframes fadePage{ from{opacity:0} to{opacity:1} }

.header{ display:flex; flex-direction:column; align-items:flex-start; margin-bottom:36px; animation:fadeUp .8s ease; }
.header img{ height:84px; max-width:100%; }
.dashboard-title{ margin-top:20px; font-size:22px; letter-spacing:4px; font-weight:900; color:var(--blue); opacity:.95; }

.filters{ display:flex; gap:12px; margin-bottom:24px; flex-wrap:wrap; animation:fadeUp .9s ease; }
select{ background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:14px; padding:12px 16px; font-size:15px; width:220px; outline: none; }
select:focus { border-color: var(--blue); }

.kpis{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px; margin-bottom:28px; animation:fadeUp 1s ease; }
.kpi{ background:linear-gradient(180deg,#050b1a,#030818); border:1px solid var(--border); border-radius:18px; padding:18px; }
.kpi span{ color:var(--muted); font-size:13px; text-transform:uppercase; }
.kpi strong{ display:block; margin-top:8px; font-size:28px; }

.cards{ display:grid; grid-template-columns:repeat(auto-fit,minmax(420px,1fr)); gap:16px; margin-bottom:24px; animation:fadeUp 1.1s ease; }
.card{ background:linear-gradient(180deg,#050b1a,#030818); border:1px solid var(--border); border-radius:22px; padding:20px; height:440px; display:flex; flex-direction:column; }
.card strong{ margin-bottom:12px; font-size:18px; display: flex; justify-content: space-between; }
.chart-wrap{ flex:1; position:relative; min-height: 0; }

.table-wrap{ overflow-x:auto; }
table{ width:100%; min-width:900px; border-collapse:collapse; }
thead{ background:linear-gradient(180deg,#020b2a,#020617); }
th{ color:var(--blue); font-weight:700; font-size:15px; padding:18px 12px; text-align:center; }
td{ padding:15px 12px; border-bottom:1px solid var(--border); font-size:14px; text-align:center; }
tr.total{ background:rgba(34,197,94,.08); font-weight:700; }

@media(max-width:900px){ .cards{grid-template-columns:1fr} }
</style>
</head>

<body>
<div class="container">
    <div class="header">
        <img src="logo.png" alt="Mentoria NasdaqPro">
        <span class="dashboard-title">DASHBOARD PROFISSIONAL</span>
    </div>

    <div class="filters">
        <select id="filtroAno"></select>
        <select id="filtroMes"></select>
        <select id="filtroSemana"></select>
    </div>

    <div class="kpis">
        <div class="kpi"><span>Trades</span><strong id="kTrades">0</strong></div>
        <div class="kpi"><span>Pontos Totais</span><strong id="kPontos">0</strong></div>
        <div class="kpi"><span>Max Drawdown</span><strong id="kDD" style="color:var(--red)">0</strong></div>
        <div class="kpi"><span>Gains</span><strong id="kGains" style="color:var(--green)">0</strong></div>
        <div class="kpi"><span>Stops</span><strong id="kStops" style="color:var(--red)">0</strong></div>
        <div class="kpi"><span>Assertividade</span><strong id="kAcc">0%</strong></div>
    </div>

    <div class="cards">
        <div class="card">
            <strong>ðŸ“ˆ Curva de PatrimÃ´nio <small id="labelDD" style="color:var(--red); font-size:12px"></small></strong>
            <div class="chart-wrap"><canvas id="chartLinha"></canvas></div>
        </div>
        <div class="card">
            <strong>ðŸ“Š DistribuiÃ§Ã£o de Resultados</strong>
            <div class="chart-wrap"><canvas id="chartBar"></canvas></div>
        </div>
    </div>

    <div class="card" style="height:auto">
        <strong>Tabela Operacional</strong>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>Dia</th>
                        <th>Pontos</th>
                        <th>Trades</th>
                        <th>Gain</th>
                        <th>Stop</th>
                        <th>0x0</th>
                        <th>Ativo</th>
                        <th>Semana</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv";
const nomesMeses={"01":"Janeiro","02":"Fevereiro","03":"MarÃ§o","04":"Abril","05":"Maio","06":"Junho","07":"Julho","08":"Agosto","09":"Setembro","10":"Outubro","11":"Novembro","12":"Dezembro"};
let data=[], chartLinha, chartBar;

async function loadCSV(){
    try {
        const r=await fetch(CSV_URL,{cache:"no-store"});
        const t=await r.text();
        parseCSV(t);
    } catch (e) { console.error("Erro ao carregar dados"); }
}

function parseCSV(t){
    const rows=t.trim().split(/\r?\n/); rows.shift();
    data=rows.map(r=>{
        const c=r.split(",");
        return{
            dia:c[0], semana:c[1], ativo:c[2],
            ano:c[0].substring(6,10), mes:c[0].substring(3,5),
            pontos:+c[3]||0, trades:+c[4]||0,
            gain:+c[5]||0, stop:+c[6]||0, zero:+c[7]||0
        }
    });
    initFiltros();
}

function initFiltros(){
    const anos=[...new Set(data.map(d=>d.ano))].sort();
    filtroAno.innerHTML=anos.map(a=>`<option value="${a}">${a}</option>`).join("");
    filtroAno.value=anos.includes(String(new Date().getFullYear())) ? new Date().getFullYear() : anos[anos.length-1];
    filtroAno.onchange=()=>{initMeses();atualizar();}
    initMeses();
}

function initMeses(){
    const meses=[...new Set(data.filter(d=>d.ano==filtroAno.value).map(d=>d.mes))].sort();
    filtroMes.innerHTML=`<option value="ALL">Todos os meses</option>`+
    meses.map(m=>`<option value="${m}">${nomesMeses[m]}</option>`).join("");
    filtroMes.value="ALL";
    filtroMes.onchange=()=>{initSemanas();atualizar();}
    initSemanas();
}

function initSemanas(){
    const fData = data.filter(d=> d.ano==filtroAno.value && (filtroMes.value==="ALL"||d.mes==filtroMes.value));
    const semanas=[...new Set(fData.map(d=>d.semana))];
    filtroSemana.innerHTML='<option value="ALL">Todas as semanas</option>'+
    semanas.map(s=>`<option value="${s}">${s}</option>`).join("");
    filtroSemana.disabled = filtroMes.value === "ALL";
    filtroSemana.value="ALL";
    filtroSemana.onchange=atualizar;
    atualizar();
}

function atualizar(){
    const f=data.filter(d=>
        d.ano==filtroAno.value &&
        (filtroMes.value==="ALL"||d.mes==filtroMes.value) &&
        (filtroSemana.value==="ALL"||d.semana==filtroSemana.value)
    );
    renderKPIs(f); renderTabela(f); renderGraficos(f);
}

function renderKPIs(f){
    let t={trades:0,pontos:0,gain:0,stop:0,zero:0};
    let peak = -Infinity, maxDD = 0, currentAcc = 0;

    f.forEach(d=>{
        t.trades+=d.trades; t.pontos+=d.pontos;
        t.gain+=d.gain; t.stop+=d.stop; t.zero+=d.zero;
        
        // CÃ¡lculo de Drawdown
        currentAcc += d.pontos;
        if(currentAcc > peak) peak = currentAcc;
        let dd = peak - currentAcc;
        if(dd > maxDD) maxDD = dd;
    });

    const ops=t.gain+t.stop;
    kTrades.textContent=t.trades;
    kPontos.textContent=t.pontos.toLocaleString();
    kGains.textContent=t.gain;
    kStops.textContent=t.stop;
    kAcc.textContent=ops?Math.round(t.gain/ops*100)+"%":"0%";
    kDD.textContent = maxDD > 0 ? `-${maxDD.toLocaleString()}` : "0";
}

function renderTabela(f){
    tbody.innerHTML="";
    f.forEach(d=>{
        tbody.innerHTML+=`
        <tr>
            <td>${d.dia}</td>
            <td style="color:${d.pontos<0?'var(--red)':'var(--green)'}; font-weight:bold">${d.pontos}</td>
            <td>${d.trades}</td>
            <td style="color:var(--green)">${d.gain}</td>
            <td style="color:var(--red)">${d.stop}</td>
            <td>${d.zero}</td>
            <td><span style="background:rgba(147,197,253,0.1); padding:4px 8px; border-radius:6px; color:var(--blue)">${d.ativo}</span></td>
            <td>${d.semana}</td>
        </tr>`;
    });
}

function renderGraficos(f){
    let acc=0; 
    const labels=[], saldo=[], ativos=[];
    
    f.forEach(d=>{ 
        acc+=d.pontos; 
        labels.push(d.dia); 
        saldo.push(acc);
        ativos.push(d.ativo);
    });

    if(chartLinha) chartLinha.destroy();
    if(chartBar) chartBar.destroy();

    const ctxLinha = document.getElementById("chartLinha").getContext("2d");
    const gradient = ctxLinha.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(34, 197, 94, 0.2)');
    gradient.addColorStop(1, 'rgba(34, 197, 94, 0)');

    chartLinha = new Chart(ctxLinha, {
        type: "line",
        data: {
            labels,
            datasets: [{
                label: 'Saldo Acumulado',
                data: saldo,
                borderColor: "#22c55e",
                backgroundColor: gradient,
                borderWidth: 3,
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointBackgroundColor: "#22c55e"
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#050b1a',
                    titleColor: '#93c5fd',
                    bodyColor: '#fff',
                    borderColor: 'rgba(255,255,255,0.1)',
                    borderWidth: 1,
                    displayColors: false,
                    callbacks: {
                        afterLabel: function(context) {
                            return `Ativo: ${ativos[context.dataIndex]}`;
                        }
                    }
                }
            },
            scales: {
                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#9ca3af' } },
                x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
            }
        }
    });

    chartBar = new Chart(document.getElementById("chartBar"), {
        type: "bar",
        data: {
            labels: ["Gains", "Stops", "0x0"],
            datasets: [{
                data: [f.reduce((a,b)=>a+b.gain,0), f.reduce((a,b)=>a+b.stop,0), f.reduce((a,b)=>a+b.zero,0)],
                backgroundColor: ["#22c55e", "#ef4444", "#facc15"],
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { grid: { color: 'rgba(255,255,255,0.05)' }, beginAtZero: true },
                x: { grid: { display: false } }
            }
        }
    });
}

loadCSV();
</script>
</body>
</html>
