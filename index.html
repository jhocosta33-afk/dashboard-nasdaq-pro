<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Dashboard NASDAQ PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#020b23;
  --border:rgba(255,255,255,.08);
  --text:#e5e7eb;
  --muted:#9ca3af;
  --green:#22c55e;
  --red:#ef4444;
  --yellow:#facc15;
}

*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}

body{
  margin:0;
  background:radial-gradient(circle at top,#0b1d4a,#020617 70%);
  color:var(--text);
}

.container{max-width:1400px;margin:auto;padding:24px}
h1{margin-bottom:16px}

.filters{display:flex;gap:12px;margin-bottom:20px}

select{
  background:var(--card);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 14px;
}

.kpis{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:16px;
  margin-bottom:24px
}

.kpi{
  background:linear-gradient(180deg,#050d2b,#020b23);
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px
}
.kpi span{font-size:13px;color:var(--muted)}
.kpi strong{font-size:26px;display:block;margin-top:6px}

.cards{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:16px;
  margin-bottom:24px
}

.card{
  background:linear-gradient(180deg,#050d2b,#020b23);
  border:1px solid var(--border);
  border-radius:22px;
  padding:18px;
  min-height:380px;
}

.card canvas{
  height:300px!important;
}

table{width:100%;border-collapse:collapse}
th,td{
  padding:12px;
  border-bottom:1px solid var(--border);
  text-align:center;
  font-size:14px
}
th{color:var(--muted)}
</style>
</head>

<body>
<div class="container">
<h1>Dashboard NASDAQ PRO</h1>

<div class="filters">
  <select id="filtroMes"></select>
  <select id="filtroSemana"></select>
</div>

<div class="kpis">
  <div class="kpi"><span>Trades</span><strong id="kTrades">0</strong></div>
  <div class="kpi"><span>Pontos</span><strong id="kPontos">0</strong></div>
  <div class="kpi"><span>Gains</span><strong id="kGains" style="color:var(--green)">0</strong></div>
  <div class="kpi"><span>Stops</span><strong id="kStops" style="color:var(--red)">0</strong></div>
  <div class="kpi"><span>0x0</span><strong id="kZero" style="color:var(--yellow)">0</strong></div>
  <div class="kpi"><span>Assertividade</span><strong id="kAcc">0%</strong></div>
</div>

<div class="cards">
  <div class="card">
    <strong>ðŸ“ˆ BalanÃ§o de Pontos</strong>
    <canvas id="chartLinha"></canvas>
  </div>
  <div class="card">
    <strong>ðŸ“Š Gains x Stops x 0x0</strong>
    <canvas id="chartBar"></canvas>
  </div>
</div>

<div class="card">
<strong>Tabela Operacional</strong>
<table>
<thead>
<tr>
<th>Dia</th><th>Semana</th><th>Pontos</th>
<th>Trades</th><th>Gain</th><th>Stop</th><th>0x0</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vTbyybCny81vfVXQHmtlkKEOHHJ6xJ_pKSG_4ndkK0tH-YocrFeWY7qL41TS1IfvRQjLSbLIILV56OV/pub?output=csv";

let dados=[],chartLinha,chartBar;

const filtroMes=document.getElementById("filtroMes");
const filtroSemana=document.getElementById("filtroSemana");

fetch(CSV_URL,{cache:"no-store"})
.then(r=>r.text())
.then(t=>{
 const rows=t.trim().split(/\r?\n/).slice(1);
 dados=rows.map(r=>{
  const c=r.split(",");
  return{
   dia:c[0],
   semana:c[1],
   mes:c[0].substring(3,5),
   pontos:+c[3]||0,
   trades:+c[4]||0,
   gain:+c[5]||0,
   stop:+c[6]||0,
   zero:+c[7]||0
  }
 });
 init();
});

function init(){
 const meses=[...new Set(dados.map(d=>d.mes))];
 filtroMes.innerHTML='<option value="ALL">TODOS OS MESES</option>'+
 meses.map(m=>`<option value="${m}">${m}</option>`).join("");

 filtroMes.onchange=()=>{
   updateSemanas();
   update();
 };
 filtroSemana.onchange=update;

 updateSemanas();
 update();
}

function updateSemanas(){
 const m=filtroMes.value;
 const semanas=[...new Set(
   dados.filter(d=>m==="ALL"||d.mes===m).map(d=>d.semana)
 )];
 filtroSemana.innerHTML='<option value="ALL">TODAS AS SEMANAS</option>'+
 semanas.map(s=>`<option>${s}</option>`).join("");
}

function update(){
 const f=dados.filter(d=>
  (filtroMes.value==="ALL"||d.mes===filtroMes.value)&&
  (filtroSemana.value==="ALL"||d.semana===filtroSemana.value)
 );

 let saldo=0;
 const acumulado=f.map(d=>saldo+=d.pontos);

 const minY=Math.min(...acumulado,0);
 const margem=Math.abs(minY)*0.15 || 50;

 renderCharts(f.map(d=>d.dia),acumulado,minY-margem);

 renderTabela(f);
}

function renderCharts(labels,acumulado,minY){
 if(chartLinha)chartLinha.destroy();
 if(chartBar)chartBar.destroy();

 chartLinha=new Chart(chartLinhaEl,{
 type:"line",
 data:{labels,datasets:[{
  data:acumulado,
  borderColor:"#22c55e",
  backgroundColor:"rgba(34,197,94,.35)",
  fill:true,
  tension:.45,
  pointRadius:4,
  pointBackgroundColor:"#22c55e"
 }]},
 options:{
  maintainAspectRatio:false,
  layout:{padding:{top:40,bottom:25,left:10,right:10}},
  scales:{
   y:{
    suggestedMin:minY,
    ticks:{padding:10}
   },
   x:{grid:{display:false}}
  },
  plugins:{legend:{display:false}}
 }
 });

 chartBar=new Chart(chartBarEl,{
 type:"bar",
 data:{labels:["Gain","Stop","0x0"],datasets:[{
  data:[
   acumulado.length?null:0
  ],
  backgroundColor:["#22c55e","#ef4444","#facc15"],
  borderRadius:10
 }]},
 options:{plugins:{legend:{display:false}}}
 });
}

function renderTabela(f){
 tbody.innerHTML=f.map(d=>`
 <tr>
 <td>${d.dia}</td><td>${d.semana}</td><td>${d.pontos}</td>
 <td>${d.trades}</td>
 <td style="color:var(--green)">${d.gain}</td>
 <td style="color:var(--red)">${d.stop}</td>
 <td style="color:var(--yellow)">${d.zero}</td>
 </tr>`).join("");
}
</script>
</body>
</html>
